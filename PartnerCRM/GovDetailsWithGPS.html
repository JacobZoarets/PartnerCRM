<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <link rel="apple-touch-icon" sizes="76x76" href="assets/img/apple-icon.png">
    <link rel="icon" type="image/png" href="assets/img/partner_logo.jpg">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <title>
        Partner CRM Survays
    </title>
    <meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0, shrink-to-fit=no' name='viewport' />
    <!--     Fonts and icons     -->
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:400,700|Material+Icons" />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css">
    <!-- CSS Files -->
    <link href="assets/css/material-kit.css?v=2.0.5" rel="stylesheet" />
    <!-- CSS Just for demo purpose, don't include it in your project -->
    <link href="assets/demo/demo.css" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css?family=Rubik" rel="stylesheet">
    <link href="assets/css/dropzone.css" rel="stylesheet" />
    <link href="https://material-components.github.io/material-components-web-catalog/static/css/main.4226abf8.css" rel="stylesheet">
    <script src="assets/js/login_functions.js"></script>

</head>
<body>
    <input id="gps_values" type="hidden" value="" />

    <nav class="navbar navbar-transparent navbar-color-on-scroll fixed-top navbar-expand-lg" color-on-scroll="100" id="sectionsNav">
        <div class="container">
            <div class="navbar-translate">
                <a class="navbar-brand" href="#">
                    Partner Surveys CRM
                </a>
                <button class="navbar-toggler" type="button" data-toggle="collapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="navbar-toggler-icon"></span>
                    <span class="navbar-toggler-icon"></span>
                    <span class="navbar-toggler-icon"></span>
                </button>
            </div>
            <div class="collapse navbar-collapse">
                <ul class="navbar-nav ml-auto">

                    <li class="nav-item">
                        <a class="nav-link" href="Index.html">
                            <i class="material-icons">cloud_download</i> רשימת סקרים
                        </a>
                    </li>

                </ul>
            </div>
        </div>
    </nav>

    <div class="page-header header-filter" data-parallax="true" style="background-image: url('assets/img/city-profile.jpg');height: 60vh;">
        <div class="container">
            <div class="row">
                <div class="col-md-8 ml-auto mr-auto">
                    <div class="brand text-center">
                        <h3 class=" text-center" style="font-family: 'Rubik', sans-serif;">סקר</h3>
                        <h1 id="survay_name" style="font-family: 'Rubik', sans-serif;">פרוייקט הנמל</h1>
                        <h3 id="survay_city" class="title text-center" style="font-family: 'Rubik', sans-serif;">תל אביב - 24.2.19</h3>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="main main-raised">
        <div class="container">
            <div class="section text-center" style="padding: 40px 0;">




                <div class="row" style="margin-top: 0px;">
                    <div class="col-lg-4 col-md-6 ml-auto mr-auto">
                        <div class="card1 card-login">
                            <form class="form" method="" action="">

                                <h3 class="description text-center">הזן את פרטי הגוב החדש</h3>


                                <div class="card-body" style="direction:rtl">


                                    <span class="bmd-form-group">

                                        <div class="input-group">
                                            <input id="input_gov_number" type="text" class="form-control" placeholder="הכנס את מספר הגוב">
                                        </div>
                                    </span>
                                    <span class="bmd-form-group">
                                        <div class="input-group">

                                            <input id="input_gov_type" type="text" class="form-control" placeholder="הכנס את סוג הגוב">
                                        </div>
                                    </span>
                                    <span class="bmd-form-group">
                                        <div class="input-group">

                                            <input id="input_gov_notes" type="text" class="form-control" placeholder="הכנס הערות (אם יש)">
                                        </div>
                                    </span>

                                    <span class="bmd-form-group">
                                        <table>
                                            <tr>
                                                <td>
                                                    <div class="input-group">
                                                        <input id="input_gov_distance" type="text" class="form-control" placeholder="הכנס מרחק מהגוב הקודם">
                                                    </div>
                                                </td>
                                                <td>
                                                    <select id="select_gov_distance_from_id" class="mdc-select__native-control" style="color: darkgray;font-size: 14px;margin-top: -2px;">
                                                        <!--<option disabled selected>בחר גוב מקור</option>
                            <option value="גוב 1123">מגוב 1123</option>
                            <option value="גוב 1123">מגוב 1123</option>
                            <option value="גוב 1123">מגוב 1123</option>-->
                                                    </select>
                                                    <input id="input_select_gov_distance_from_id" type="text" class="form-control" placeholder="" style="display:none">
                                                </td>
                                            </tr>
                                        </table>


                                    </span>




                                    <div class="input-group">


                                        <h5>תפוסת צנרת</h5>
                                        <table>
                                            <tbody>
                                                <tr>
                                                    <td>
                                                        <div class="form-check" style="margin-top:0px;padding-top:0px;">
                                                            <label class="form-check-label">
                                                                <input class="form-check-input" type="radio" name="exampleRadios" id="radio_button_empty" value="ריקה">ריקה
                                                                <span class="circle">
                                                                    <span class="check"></span>
                                                                </span>
                                                            </label>
                                                        </div>
                                                    </td>

                                                    <td>
                                                        <div class="form-check" style="margin-top:0px;padding-top:0px;">
                                                            <label class="form-check-label">
                                                                <input class="form-check-input" type="radio" name="exampleRadios" id="radio_button_mid" value="בינונית" checked=""> בינונית
                                                                <span class="circle">
                                                                    <span class="check"></span>
                                                                </span>
                                                            </label>
                                                        </div>
                                                    </td>
                                                    <td>
                                                        <div class="form-check" style="margin-top:0px;padding-top:0px;">
                                                            <label class="form-check-label">
                                                                <input class="form-check-input" type="radio" name="exampleRadios" id="radio_button_full" value="מלאה" checked=""> מלאה
                                                                <span class="circle">
                                                                    <span class="check"></span>
                                                                </span>
                                                            </label>
                                                        </div>
                                                    </td>
                                                </tr>

                                            </tbody>
                                        </table>





                                    </div>
                                    <h5 style="text-align:right;">סוג מתקן</h5>

                                    <div class="input-group">

                                        <table>

                                            <tbody>
                                                <tr>
                                                    <td>
                                                        <div class="form-check" style="margin-top:0px;padding-top:0px;">
                                                            <label class="form-check-label">
                                                                <input class="form-check-input" type="radio" name="example_Radios" id="radio_button_25" value="25">25
                                                                <span class="circle">
                                                                    <span class="check"></span>
                                                                </span>
                                                            </label>
                                                        </div>
                                                    </td>

                                                    <td>
                                                        <div class="form-check" style="margin-top:0px;padding-top:0px;">
                                                            <label class="form-check-label">
                                                                <input class="form-check-input" type="radio" name="example_Radios" id="radio_button_40" value="40" checked=""> 40
                                                                <span class="circle">
                                                                    <span class="check"></span>
                                                                </span>
                                                            </label>
                                                        </div>
                                                    </td>
                                                    <td>
                                                        <div class="form-check" style="margin-top:0px;padding-top:0px;">
                                                            <label class="form-check-label">
                                                                <input class="form-check-input" type="radio" name="example_Radios" id="radio_button_60" value="60" checked=""> 60
                                                                <span class="circle">
                                                                    <span class="check"></span>
                                                                </span>
                                                            </label>
                                                        </div>
                                                    </td>
                                                </tr>

                                            </tbody>
                                        </table>





                                    </div>

                                    <img id="gov_img" src="#" style="width: 100%;display:none" />
                                    <div id="holder-zone" style="text-align: center;" class="dz-clickable dz-started">
                                        <a href="javascript:$('#holder-zone').trigger('click');">
                                            <h5 style="text-align:right;">העלה תמונה</h5>
                                        </a>
                                    </div>
                                    <br />


                                    <div id="gov_video" style="display:none">
                                        <video style="width: 100%;" controls>
                                            <source id="video_src" src="#" type="video/mp4">
                                            Your browser does not support HTML5 video.
                                        </video>
                                    </div>

                                    <div id="holder-zone-video" style="text-align: center;" class="dz-clickable dz-started">
                                        <a href="javascript:$('#holder-zone-video').trigger('click');">
                                            <h5 style="text-align:right;">העלה סרטון </h5>
                                        </a>
                                    </div>


                                </div>
                                <div id="control_strip" class=" text-center">
                                    <a href="#" class="btn btn-primary" onclick="add_new_gov()">הוסף</a>
                                    <a href="#" class="btn btn-primary btn-link " onclick="return_home()">ביטול</a>
                                </div>
                                <div id="control_strip_update" class="text-center" style="display:none">
                                    <a href="#" class="btn btn-primary" onclick="update_gov()">עדכן</a>
                                    <a href="#" class="btn btn-primary btn-link " onclick="return_home()">ביטול</a>
                                </div>
                                <a id="delete_gov_link" href="#" onclick="delete_gov()" style="display:none">מחק גוב</a>
                            </form>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <!--   Core JS Files   -->
    <script src="assets/js/core/jquery.min.js" type="text/javascript"></script>
    <script src="assets/js/core/popper.min.js" type="text/javascript"></script>
    <script src="assets/js/core/bootstrap-material-design.min.js" type="text/javascript"></script>
    <script src="assets/js/plugins/moment.min.js"></script>
    <!--	Plugin for the Datepicker, full documentation here: https://github.com/Eonasdan/bootstrap-datetimepicker -->
    <script src="assets/js/plugins/bootstrap-datetimepicker.js" type="text/javascript"></script>
    <!--  Plugin for the Sliders, full documentation here: http://refreshless.com/nouislider/ -->
    <script src="assets/js/plugins/nouislider.min.js" type="text/javascript"></script>
    <!--  Google Maps Plugin    -->
    <!--<script src="https://maps.googleapis.com/maps/api/js?key=YOUR_KEY_HERE"></script>-->
    <!-- Control Center for Material Kit: parallax effects, scripts for the example pages etc -->
    <script src="assets/js/material-kit.js?v=2.0.5" type="text/javascript"></script>
    <script src="assets/js/dropzone.js"></script>
    <script src="assets/js/bootstrap-notify.js"></script>

    <script type="text/javascript">

        $(document).ready(function () {


            // check is user is logged in
            var admin_type = is_logged_in();
            if (admin_type == "") {
                console.log("user is not logged in!!! redirect to login");
                document.location.href = "Login.html";
            }

            // Handler for .ready() called.
            var survay_id = getUrlVars()["survay_id"].replace("#", "");
            var gov_id = getUrlVars()["gov_id"].replace("#", "");

            if (survay_id !== undefined) {
                survay_id = survay_id.replace("#", "");
                gov_id = gov_id.replace("#", "");

                get_survay_data(survay_id);
                if (gov_id == "new") {

                }
                else
                    get_gov_Details(gov_id);

            }



            $("div#holder-zone").dropzone({
                url: "Uploader.aspx",
                renameFile: function (file) {
                    if ($('#input_gov_number').val() != "") {
                        svals = file.name.split(".");
                        return file.name = $('#input_gov_number').val() + "." + svals[svals.length - 1];
                    }
                    return file.name = file.name;
                },
                success: function (file, response) {
                    //alert(response);
                    $("#holder-zone").css("display", "none");
                    $("#gov_img").attr("src", response);
                    $("#gov_img").css("display", "block");
                }
            });

            var myDropzoneTheSecond = new Dropzone(
                'div#holder-zone-video', {
                    url: "Uploader.aspx",
                    renameFile: function (file) {
                        if ($('#input_gov_number').val() != "") {
                            svals = file.name.split(".");
                            return file.name = $('#input_gov_number').val() + "." + svals[svals.length - 1];
                        }
                        return file.name = file.name;
                    },
                    success: function (file, response) {
                        //alert(response);
                        //user_images.push(response)
                        $("#holder-zone-video").css("display", "none");
                        //$("#gov_video").attr("src", response);
                        $("#video_src").attr("src", response);
                        $("#gov_video").css("display", "block");
                        $("#gov_video video")[0].load();
                    }
                }
            );

            

        });

       

        

        function getUrlVars() {
            var vars = [], hash;
            var q = document.URL.split('?')[1];
            if (q != undefined) {
                q = q.split('&');
                for (var i = 0; i < q.length; i++) {
                    hash = q[i].split('=');
                    vars.push(hash[1]);
                    vars[hash[0]] = hash[1];
                }
            }
            return vars;
        }
                
        function get_survay_data(survay_id) {

            url = "DataGetter.aspx/get_survay_data";
            data = "{survay_id:'" + survay_id + "'}";

            $.ajax({
                type: "POST",
                url: url,
                data: data,
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: OnSuccess_get_survay_data,
                failure: function (response) {
                    alert(response.d);
                },
                error: function (response) {
                    alert(response.d);
                }
            });
        }

        function OnSuccess_get_survay_data(response) {

            vals = response.d.split(";");
            //תל אביב - 24.2.19
            $('#survay_name').html(vals[0]);
            $('#survay_city').html(vals[1] + " - " + vals[2]);

            if (vals.length == 4) {
                $('#select_gov_distance_from_id').html(vals[3]);                 
            }
        }

        function get_gov_Details(gov_id) {


            url = "DataGetter.aspx/get_gov_details";
            data = "{gov_id:'" + gov_id + "'}";

            $.ajax({
                type: "POST",
                url: url,
                data: data,
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: OnSuccess_get_gov_Details,
                failure: function (response) {
                    alert(response.d);
                },
                error: function (response) {
                    alert(response.d);
                }
            });

        }

        function OnSuccess_get_gov_Details(response) {

            // alert(response.d);


            vals = response.d.split(";");
            //alert(vals[0]);
            //תל אביב - 24.2.19
            $('#input_gov_number').val(vals[0]);
            $('#input_gov_type').val(vals[1]);
            $('#input_gov_notes').val(vals[2]);


            if (vals[3] == "ריקה") {
                var element_id = "#radio_button_empty";
                $(element_id).parent().addClass("active");
                $(element_id).prop('checked', true);
            } else if (vals[3] == "בינונית") {
                var element_id = "#radio_button_mid";
                $(element_id).parent().addClass("active");
                $(element_id).prop('checked', true);
            } else if (vals[3] == "מלאה") {
                var element_id = "#radio_button_full";
                $(element_id).parent().addClass("active");
                $(element_id).prop('checked', true);
            }


            if (vals[4] == "25") {
                var element_id = "#radio_button_25";
                $(element_id).parent().addClass("active");
                $(element_id).prop('checked', true);
            } else if (vals[4] == "40") {
                var element_id = "#radio_button_40";
                $(element_id).parent().addClass("active");
                $(element_id).prop('checked', true);
            } else if (vals[4] == "60") {
                var element_id = "#radio_button_60";
                $(element_id).parent().addClass("active");
                $(element_id).prop('checked', true);
            }

            if (vals[5] != "") {
                $("#gov_img").attr("src", vals[5]);
                $("#gov_img").css("display", "block");
            }
            if (vals[6] != "") {
                $("#video_src").attr("src", vals[6]);
                $("#gov_video").css("display", "block");
                $("#gov_video video")[0].load();
            }

            if (vals[7] != "") {
                // distance text box input_gov_distance
                $('#input_gov_distance').val(vals[7]);
            }

            if (vals[8] != "") {
                // distance text box 
                $("#input_select_gov_distance_from_id").css("display", "block");
                $('#input_select_gov_distance_from_id').val(vals[8]);
                $("#select_gov_distance_from_id").css("display", "none");
            }

            $("#control_strip_update").css("display", "block");

            $("#control_strip").css("display", "none");
            $("#holder-zone").css("display", "none");
            $("#holder-zone-video").css("display", "none");



            var admin_type = is_logged_in();
            if (admin_type == "1" || admin_type == "2") {
                $("#delete_gov_link").css("display", "block");
            }

            
        }

        function update_gov() {
            var gov_id = getUrlVars()["gov_id"].replace("#", "");

            var number = $('#input_gov_number').val();
            var type = $('#input_gov_type').val();
            var notes = $('#input_gov_notes').val();

            var plumbing = $("input[name='exampleRadios']:checked").val();
            var contraction_type = $("input[name='example_Radios']:checked").val();
            var image_path_url = $("#gov_img").attr("src");
            var video_path_url = $("#video_src").attr("src");

            var distance = $('#input_gov_distance').val();
            var distance_from_gov_id = $('#select_gov_distance_from_id').find(":selected").text() + "";



            url = "DataGetter.aspx/update_gov";
            data = "{gov_id:'" + gov_id + "',number:'" + number + "',type:'" + type + "',notes:'" + notes + "',plumbing:'" + plumbing + "',contraction_type:'" + contraction_type + "',image_path_url:'" + image_path_url + "',video_path_url:'" + video_path_url + "',distance:'" + distance + "',distance_from_gov_id:'" + distance_from_gov_id + "'}";

            $.ajax({
                type: "POST",
                url: url,
                data: data,
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: OnSuccess_update_gov,
                failure: function (response) {
                    alert(response.d);
                },
                error: function (response) {
                    alert(response.d);
                }
            });

        }

        function OnSuccess_update_gov(response) {

            //alert(response.d);
            showNotification("", "הגוב עודכן בהצלחה.");

            setTimeout(return_home, 1000);


        }

        function add_new_gov() {


            if (navigator.geolocation) {
                // we'll add the gov in the respone
                navigator.geolocation.getCurrentPosition(showPosition, showError);
            } else {
                console.log("Geolocation is not supported by this browser. continue in adding new gov");
                add_new_gov_form()
            }

        }

        function showPosition(position) {
            console.log("Latitude: " + position.coords.latitude + " Longitude: " + position.coords.longitude);
            $("#gps_values").val("Latitude:" + position.coords.latitude + " Longitude:" + position.coords.longitude);
            add_new_gov_form();
        }

        function showError(error) {
            switch (error.code) {
                case error.PERMISSION_DENIED:
                    console.log("User denied the request for Geolocation.");
                    break;
                case error.POSITION_UNAVAILABLE:
                    console.log("Location information is unavailable.");
                    break;
                case error.TIMEOUT:
                    console.log("The request to get user location timed out.")
                    break;
                case error.UNKNOWN_ERROR:
                    console.log("An unknown error occurred.");
                    break;
            }

            add_new_gov_form();
        }

        function add_new_gov_form() {


            //string survay_id, string number, string type, string notes, string plumbing, string contraction_type, string image_path_url, string video_path_url
            var survay_id = getUrlVars()["survay_id"].replace("#", "");
            survay_id = survay_id.replace("#", "");
            var number = $('#input_gov_number').val();
            var type = $('#input_gov_type').val();
            var notes = $('#input_gov_notes').val();

            var plumbing = $("input[name='exampleRadios']:checked").val();
            var contraction_type = $("input[name='example_Radios']:checked").val();
            var image_path_url = $("#gov_img").attr("src");
            var video_path_url = $("#video_src").attr("src");

            var distance = $('#input_gov_distance').val();
            var distance_from_gov_id = $('#select_gov_distance_from_id').find(":selected").text() + "";

            var gps_values = $('#gps_values').val();

            url = "DataGetter.aspx/add_new_gov";
            data = "{survay_id:'" + survay_id + "',number:'" + number + "',type:'" + type + "',notes:'" + notes + "',plumbing:'" + plumbing + "',contraction_type:'" + contraction_type + "',image_path_url:'" + image_path_url + "',video_path_url:'" + video_path_url + "',distance:'" + distance + "',distance_from_gov_id:'" + distance_from_gov_id + "'}";

            $.ajax({
                type: "POST",
                url: url,
                data: data,
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: OnSuccess_add_new_gov,
                failure: function (response) {
                    alert(response.d);
                },
                error: function (response) {
                    alert(response.d);
                }
            });

        }

        

        function OnSuccess_add_new_gov(response) {

            //alert(response.d);
            showNotification("", "הגוב נרשם בהצלחה.");

            setTimeout(return_home, 1000);


        }

        function delete_gov() {
            var gov_id = getUrlVars()["gov_id"].replace("#","");

            url = "DataGetter.aspx/delete_gov";
            data = "{gov_id:'" + gov_id + "'}";

            $.ajax({
                type: "POST",
                url: url,
                data: data,
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: OnSuccess_delete_gov,
                failure: function (response) {
                    alert(response.d);
                },
                error: function (response) {
                    alert(response.d);
                }
            });

        }

        function OnSuccess_delete_gov(response) {

            //alert(response.d);
            showNotification("", "הגוב נמחק בהצלחה.");

            setTimeout(return_home, 1000);


        }

        function return_home() {
            var survay_id = getUrlVars()["survay_id"].replace("#", "");
            survay_id = survay_id.replace("#","");
            window.location.href = 'SingleSurvay.html?survay_id=' + survay_id;
        }

        function goBack() {
            window.history.back();
        }
    </script>

</body>
</html>